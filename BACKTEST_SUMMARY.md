# 黄金价格反转检测算法回测总结报告

## 用户需求
基于趋势线突破检测价格反转：
- 下降趋势中：计算高点加权平均线，价格突破 → 看涨反转
- 上升趋势中：计算低点加权平均线，价格突破 → 看跌反转

## 用户标注的6个反转点（美国东部时间）
1. 2026-02-20 13:15 ET - 上升趋势反转
2. 2026-02-20 08:15 ET - 上升趋势反转
3. 2026-02-20 03:45 ET - 上升趋势反转
4. 2026-02-19 18:45 ET - 上升趋势反转
5. 2026-02-19 15:45 ET - 下降趋势反转
6. 2026-02-20 02:45 ET - 下降趋势反转

---

## 算法对比测试结果

### 算法1：N字形形态检测（原有算法）
- **匹配率**: 33% (2/6)
- **最佳参数**:
  - MIN_REVERSAL_THRESHOLD = 0.0005
  - SWING_WINDOW_SIZE = 2
  - MIN_STRENGTH = 0.15
- **匹配的反转**:
  - ✓ 02-19 15:45 ET (下降)
  - ✓ 02-19 18:45 ET (上升)
- **问题**:
  - 2月20日的4个反转全部未检测到
  - 算法检测LOW-HIGH-LOW形态，对平缓波动不敏感

---

### 算法2：趋势线突破检测（新实现）
- **匹配率**: 50% (3/6)
- **最佳参数**:
  - TREND_WINDOW_HOURS = 6 (趋势识别窗口)
  - MIN_PIVOT_DISTANCE = 2 (摆动点间隔)
  - BREAKOUT_THRESHOLD = 0.0008 (0.08%突破阈值)
  - MIN_COOLDOWN_MINUTES = 30 (防重复触发冷却时间)
  - TREND_SLOPE_THRESHOLD = 0.005% (趋势识别斜率)
- **检测情况**:
  - 总检测: 16个反转
  - 匹配: 3个
  - 误报: 13个
- **问题**:
  - 误报率较高
  - 对震荡行情容易产生虚假信号

---

## 核心问题分析

### 1. 数据特征
- 2月19日数据有明显波动，两种算法都能检测到
- 2月20日数据波动平缓，两种算法都难以准确识别

### 2. 算法局限性

**N字形算法**:
- 要求形成完整的N字形结构（至少3个摆动点）
- 对逐步上升/下降的趋势不敏感
- 适合波动较大的市场

**趋势线算法**:
- 依赖线性回归识别趋势方向
- 在震荡市场中容易误判
- 突破检测对阈值非常敏感，难以平衡灵敏度和误报率

### 3. 参数敏感度
- 降低阈值提高检测率 → 误报大幅上升
- 提高阈值减少误报 → 漏掉真实反转
- 需要在敏感度和稳定性之间权衡

---

## 推荐方案

### 方案A：使用趋势线算法（推荐）
**优点**:
- 匹配率50%，优于N字形的33%
- 与您描述的判断方法一致
- 可调整参数适应不同市场环境

**配置**:
```env
# 趋势线分析参数
TREND_WINDOW_HOURS=6          # 趋势识别窗口（小时）
MIN_PIVOT_DISTANCE=2          # 摆动点最小间隔
BREAKOUT_THRESHOLD=0.0008     # 突破阈值（0.08%）
MIN_COOLDOWN_MINUTES=30       # 防重复触发冷却时间
```

**预期效果**:
- 能捕获50%的标注反转
- 平均每天检测2-3个反转（含误报）
- 适合作为辅助参考，不应完全依赖

---

### 方案B：混合算法（更稳定）
结合两种算法，当同时满足时才触发：
1. 趋势线突破检测到反转
2. N字形形态确认反转

**优点**:
- 大幅降低误报
- 提高信号可靠性

**缺点**:
- 匹配率会进一步降低
- 可能漏掉部分反转

---

### 方案C：添加其他技术指标（需额外开发）
考虑添加辅助指标提高准确性：
1. **移动平均线**: 5周期MA与20周期MA交叉确认
2. **RSI指标**: 超买/超卖+背离确认反转
3. **成交量**: 放量突破增加可信度
4. **布林带**: 价格触及上下轨确认反转

**实现难度**: 中等（需要1-2天开发时间）
**预期效果**: 匹配率可能提升至60-70%，误报显著降低

---

## 下一步建议

请选择以下方案之一：

1. **接受方案A**：使用趋势线算法（50%匹配率，有误报）
   - 我可以立即将其集成到主程序
   - 更新.env配置参数
   - 修改飞书通知逻辑

2. **尝试方案B**：实现混合算法（更稳定，但匹配率可能下降）
   - 需要额外开发half天
   - 可以先测试效果再决定是否采用

3. **开发方案C**：添加MA/RSI等技术指标（最全面，需1-2天）
   - 实现移动平均线交叉检测
   - 实现RSI超买超卖检测
   - 综合多个指标生成反转信号

4. **暂不采用自动反转检测**：
   - 仅保留价格监控和K线图展示
   - 手动判断反转时机

请告知您的选择，我会据此进行相应的开发和配置。
