# 黄金监控系统 - 青龙面板版使用说明

## 功能特性

本系统已适配青龙面板，每次运行输出：
- ✅ 即时黄金价格信息（数据来源：AKShare / 上海黄金交易所）
- ✅ 当天价格走势图（ASCII字符图）
- ✅ 综合交易分析报告（趋势分析 + 交易建议）
- ✅ 结果输出到控制台、文件和飞书（可选）

## 快速开始

### 1. 安装依赖

```bash
cd /path/to/gold-monitor
pip3 install -r requirements.txt
```

**主要依赖：**
- `akshare` - 金融数据接口库（获取黄金价格）
- `python-dotenv` - 环境变量管理
- `requests` - HTTP 请求（飞书通知）

### 2. 配置飞书 Webhook（可选）

如果需要飞书通知功能，需要配置 Webhook URL：

**获取飞书 Webhook URL 的步骤：**
1. 打开飞书群聊
2. 点击右上角「设置」
3. 选择「群机器人」
4. 点击「添加机器人」
5. 选择「自定义机器人」
6. 设置机器人名称和描述
7. 复制生成的 Webhook 地址

然后创建 `.env` 文件：

```bash
cp .env.example .env
# 编辑 .env 填入 Webhook URL
```

环境变量说明：
- `FEISHU_WEBHOOK_URL` - 飞书群机器人 Webhook 地址（可选）
- `TREND_COUNT` - 触发通知的连续次数（默认3）
- `LOG_LEVEL` - 日志级别（默认INFO）

### 3. 运行模式

#### 单次运行（青龙面板模式）
```bash
python3 src/main.py
```

#### 测试连接
```bash
python3 src/main.py test
```

#### 循环监控模式（本地测试）
```bash
python3 src/main.py loop
```

#### 功能测试（使用模拟数据）
```bash
python3 test_mock.py
```

## 青龙面板配置

### 添加任务

1. **任务名称**：黄金价格监控
2. **命令**：
   ```bash
   cd /ql/data/scripts/gold-monitor && python3 src/main.py
   ```
3. **定时规则**：
   ```
   0 */5 9-16 * * *    # 工作日 9:00-16:00 每5分钟运行
   0 0 10 * * *        # 每天 10:00 运行一次
   ```

### 环境变量配置

在青龙面板「环境变量」中添加（如需飞书通知）：
```
FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/your-token
```

## 输出示例

```
============================================================
           黄金价格监控 - 运行结果
============================================================

══════════════════════════════════════════════════
                   黄金交易分析报告
══════════════════════════════════════════════════

【即时行情】
  品种名称: AU9999
  当前价格: 504.40 元/克
  今日开盘: 500.00 元/克
  最高价格: 504.90 元/克
  最低价格: 499.80 元/克
  涨跌额:   +4.40 元
  涨跌幅:   +0.88%

【趋势分析】
  检测结果: 连续3次上涨 ↗
  起始价格: 503.60 元/克
  当前价格: 504.40 元/克
  累计涨幅: +0.16%
  价格序列: 503.60 → 504.00 → 504.40

【交易建议】
  操作建议: 持有观望
  理由:     虽有上涨趋势，但涨幅较小（0.16%），建议继续观察
  风险等级: 低

【统计摘要】
  历史记录: 15 条
  今日检查: 15 次
  趋势次数: 3 次连续
  今日最高: 504.40 元/克
  今日最低: 500.00 元/克
  今日振幅: 4.40 元/克

运行时间: 2026-02-19 19:07:00
══════════════════════════════════════════════════

当天黄金价格走势 (2026-02-19)
━━━━━━━━━━━━━━━━━━━━━
504.40 ┤                                              ──●
503.91 ┤                                          ─●──
503.42 ┤                                  ─●───●──
502.93 ┤                             ──●──
502.44 ┤                     ─●───●──
501.96 ┤                 ─●──
501.47 ┤        ──●───●──
500.98 ┤    ─●──
500.49 ┤─●──
500.00 ┤
       └──────────────────────────────────────────────
        09:00                                    16:00
━━━━━━━━━━━━━━━━━━━━━
最高: 504.40  最低: 500.00  振幅: 4.40  数据点: 15
```

## 数据存储

- 历史价格：`data/price_history.json`（保留最近1000条）
- 通知状态：`data/notify_state.json`（避免重复通知）
- 运行日志：`logs/gold_monitor.log`
- 输出结果：`output/result_YYYYMMDD_HHMMSS.txt`

## 数据来源

本系统使用 **AKShare** 开源金融数据库：

- **实时价格**：上海黄金交易所（SGE）现货报价
- **品种代码**：AU9999（Au99.99）
- **更新频率**：交易时间实时更新
- **数据准确性**：官方权威数据源
- **优势**：稳定可靠，无需 API Key，开源免费

**AKShare 简介：**
- 官网：https://akshare.akfamily.xyz/
- 特点：免费、开源、中文文档完善
- 支持：股票、期货、黄金、外汇等多种金融数据

## 注意事项

1. **首次运行**：需要积累至少3条数据才能进行趋势分析
2. **飞书通知**：仅在趋势方向改变时发送，避免刷屏
3. **历史数据**：自动持久化，跨天运行不清空，持续积累
4. **青龙日志**：控制台输出会被青龙面板捕获并显示
5. **网络要求**：需要能访问上海黄金交易所数据接口

## 常见问题

**Q: 如何获取飞书 Webhook URL？**
A: 在飞书群聊中：设置 → 群机器人 → 添加机器人 → 自定义机器人 → 复制 Webhook 地址

**Q: 为什么没有生成走势图？**
A: 当天数据不足2条时无法绘图，多运行几次即可。

**Q: 飞书通知没有收到？**
A: 检查 Webhook URL 是否正确配置，或查看日志了解具体错误。

**Q: 如何调整趋势灵敏度？**
A: 修改环境变量 `TREND_COUNT`，值越小越敏感（默认3）。

**Q: ASCII图表显示乱码？**
A: 修改 `src/main.py:45` 设置 `use_unicode=False` 使用基础ASCII字符。

## 技术支持

项目仓库：https://github.com/your-repo/gold-monitor
